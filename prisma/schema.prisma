generator client {
   provider = "prisma-client-js"
   output   = "./generated/client"
}

datasource db {
   provider = "postgresql"
   url      = env("PSQL_DATABASE_URL")
}

enum TransactionType {
   INCOME
   EXPENSE
}

enum TransactionMethod {
   PIX
   DEBIT
   CREDIT
}

model Card {
   id         String  @id @default(uuid())
   nickname   String
   issuerId   String
   userId     String
   number     String? @unique
   expiration String?
   cvv        String?
   debit      Boolean @default(false)
   credit     Boolean @default(false)

   // Foreign keys
   issuer Issuer @relation(fields: [issuerId], references: [id])
   user   User   @relation(fields: [userId], references: [id])

   // Relations
   creditCard  CreditCard?
   debitCard   DebitCard?
   transaction Transaction[]

   // Timestamps
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
}

model CreditCard {
   id        String @id @default(uuid())
   limit     Float
   usedLimit Float  @default(0.0)
   cardId    String @unique

   // Foreign keys
   card Card @relation(fields: [cardId], references: [id])

   // Timestamps
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
}

model DebitCard {
   id      String @id @default(uuid())
   balance Float  @default(0.0)
   cardId  String @unique

   // Foreign keys
   card Card @relation(fields: [cardId], references: [id])

   // Timestamps
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
}

model Issuer {
   id    String  @id @default(uuid())
   name  String
   color String
   icon  String?

   // Relations
   card Card[]

   // Timestamps
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
}

model Transaction {
   id          String            @id @default(uuid())
   type        TransactionType
   amount      Float
   date        DateTime
   method      TransactionMethod
   cardId      String
   userId      String
   currency    String            @default("USD")
   description String?

   // Foreign keys
   card Card @relation(fields: [cardId], references: [id])

   // Timestamps
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
}

model User {
   id       String  @id @default(uuid())
   email    String  @unique
   password String
   name     String?
   cpf      String? @unique
   phone    String?

   // Relations
   card     Card[]
   sessions Session[]

   // Timestamps
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
}

model Session {
   id           String   @id @default(uuid())
   userId       String
   sessionToken String   @unique
   expires      DateTime

   // Foreign keys
   user User @relation(fields: [userId], references: [id])

   // Timestamps
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
}
